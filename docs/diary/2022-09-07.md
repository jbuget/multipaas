# 2022-09-07 - Le registre

Dans Fastify, il n'est (toujours) pas possible d'ajouter des routes ou des plugins √† la vol√©e (cf. [issue #149](https://github.com/fastify/help/issues/149)).

Dans mon cas, ce n'est pas si grave. 
Si une app se fait proxifi√©e une fois, si jamais elle doit √™tre r√©veill√©e, au moins le routage sera pr√™t.

Mais il me vient une r√©flexion : si on ne peut pas proxifier des routes/apps √† la vol√©e, comment manager de nouvelles apps, pas pr√©sentes au d√©marrage ?

Pistes :
- Peut-√™tre que `@fastify/http-proxy`, de par son comportement bas√© sur les prefix de requ√™tes, permet de le faire
- Peut-√™tre que je vais vraiment devoir faire le proxy √† la main (et bye-bye la semi-gestion des WebSockets)

Mais du coup, quite √† faire un simple proxy_pass, pourquoi s'emb√™ter avec Nginx ü§î

> ‚ö†Ô∏è Quid des requ√™tes de fichier / multipart / stream ?

Et si le plus simple √©tait de passer directement par [`fastify-reply-from`](https://github.com/fastify/fastify-reply-from) ? 
Comme √ßa plus de besoin de Nginx.
Et je r√©cup√®re directement le app_name (via tldts).
Testons.

Call avec JOP
https://publicsuffix.org/
proposer √† Scalingo de faire comme Heroku et proposer un Public Suffix
pour tous les h√©bergeurs qui revendent des sous-domaines, permet de prot√©ger 2 sites h√©berg√©s qui n'ont rien √† voir

J'ai zapp√© le cas o√π une RA est cr√©√©e (90% des cas).
Et tant que je n'essaye pas d'y acc√©der, elle ne sera pas manag√©e.
Mais du coup, mon truc ne sert √† rien en l'√©tat.
Il me faut absolument poller l'API de Scalingo r√©guli√®rement.
Toutes les minutes.

Fastify c'est overkill.
https://github.com/http-party/node-http-proxy#setup-a-stand-alone-proxy-server-with-custom-server-logic
permet de choisir la target √† la vol√©e

> ‚ö†Ô∏è je suis oblig√© de mettre la r√©gion dans le sous-sous-domaine. Ou pas.

Bloc de commandes shel √† ex√©cuter quand on √©teint
Bloc de commandes shel √† ex√©cuter quand on allume



