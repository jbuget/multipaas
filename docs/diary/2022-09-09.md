# 2022-09-09 - 

## ‚úÖ It works again!

Aujourd'hui, rien ne fonctionne correctement.
Depuis hier et quelques modifs, impossible de d√©ployer et scaler correctement l'application Scalingo `paastis-proxy`.

Rahhh‚Ä¶ C'√©tait tout bidon.
Quand j'ai mis en place la config, j'ai mis `localhost` en host par d√©faut plut√¥t que `0.0.0.0`.
Et donc, selon les r√®gles de Scalingo, l'application n'√©coutait pas correctement le bon host + port.
Pfff‚Ä¶ 2h de perdues pour une b√™tise.

## üö¶ Supervisor, Redis & POO

Redis va permettre d'avoir du scaling horizontal.
Toutes les instances de `paastis-proxy` vont pouvoir s'appuyer sur une seule et m√™me source de v√©rit√©.

L'un des soucis, c'est qu'en l'√©tat, on peut avoir plusieurs instances qui tentent de d√©marrer ou couper une m√™me app en m√™me temps (ou dans un temps trop court).

Plusieurs solutions :
- sortir le cron dans un nouveau processus, mais d√©pendant du mode de fonctionnement de Scalingo / Heroku. Pas tr√®s host-provider agnostic
- sortir le cron dans un nouveau module/workspace `paastis-supervisor`
- avoir une cl√© `last_checked_at` dans Redis, mais il faut s'assurer qu'on locke bien la base

Quoi qu'il en soit, l'id√©e est de supporter 2 types de index store :
- `in-memory`
- `redis`

Pour √ßa, on va utiliser les m√©canismes (tr√®s basiques) de POO de JavaScript.

